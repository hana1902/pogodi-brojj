<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Pogodi broj</title>

</head>
<body>
    <header>
    <button id="themeToggle" class="theme-btn">üåô Dark / ‚òÄÔ∏è Light</button>
    <h1 class="typewriter"></h1>
    <div class="vs">
        <input type="text"class="cell2" maxlength="2">
        <h1>VS</h1>
        <input type="text"class="cell2" maxlength="2">
    </div>
    <div class="win">
        <input type="text"class="cell3" maxlength="1">
        <input type="text"class="cell3" maxlength="1">
    </div>
</header>

<h2>Moj broj:</h2>

<div class="guess-input">
    <input type="text" class="cell" maxlength="1">
    <input type="text" class="cell" maxlength="1">
    <input type="text" class="cell" maxlength="1">
    <input type="text" class="cell" maxlength="1">
    <input type="text" class="cell" maxlength="1">
</div>

<h3>Moji poku≈°aji za<br>pogaƒëanje broja:</h3>

<!-- DODAJEM 5 REDOVA PO 5 POLJA -->
<div id="attempts"></div>
<button id="deleteBtn">Obri≈°i</button>
    <script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// DARK / LIGHT MODE
const toggleBtn = document.getElementById("themeToggle");
toggleBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode"); 
});

const attempts = document.getElementById("attempts");

// Kreiranje 6 redova po 5 polja
const totalRows = 6;
const totalCells = 5;

// ƒåuvamo reference na sva polja da lak≈°e menjamo boje
let cells = [];

for (let r = 0; r < totalRows; r++) {
    let row = document.createElement("div");
    row.classList.add("guess-input");

    let rowCells = [];

    for (let i = 0; i < totalCells; i++) {
        let cell = document.createElement("input");
        cell.type = "text";
        cell.maxLength = 1;
        cell.classList.add("cell");

        // Klik za menjanje boja (lokalno)
        cell.addEventListener("click", function () {
            if (cell.classList.contains("green")) {
                cell.classList.remove("green");
            } else if (cell.classList.contains("yellow")) {
                cell.classList.remove("yellow");
                cell.classList.add("green");
            } else {
                cell.classList.add("yellow");
            }

            // Po≈°alji serveru promenu boje
            const cellIndex = rowCells.indexOf(cell);
            socket.emit("colorChange", { row: r, cell: cellIndex, color: cell.className });
        });

        // Dozvoli unos samo cifara i po≈°alji serveru
        cell.addEventListener("input", function () {
            cell.value = cell.value.replace(/[^0-9]/g, "");
            const cellIndex = rowCells.indexOf(cell);
            socket.emit("inputChange", { row: r, cell: cellIndex, value: cell.value });
        });

        row.appendChild(cell);
        rowCells.push(cell);
    }

    cells.push(rowCells);
    attempts.appendChild(row);
}

// Dugme za brisanje
const deleteBtn = document.getElementById("deleteBtn");
deleteBtn.addEventListener("click", () => {
    resetCells();
    socket.emit("reset"); // Obavesti drugog igraƒça
});

// Funkcija za reset svih polja
function resetCells() {
    cells.forEach(row => {
        row.forEach(cell => {
            cell.value = "";
            cell.classList.remove("green", "yellow");
        });
    });
}

// Prijem dogaƒëaja sa servera

// Kada drugi igraƒç menja boju
socket.on("colorChange", data => {
    const { row, cell, color } = data;
    const targetCell = cells[row][cell];
    targetCell.className = "cell"; // prvo ukloni sve boje
    if(color.includes("green")) targetCell.classList.add("green");
    else if(color.includes("yellow")) targetCell.classList.add("yellow");
});

// Kada drugi igraƒç menja unos
socket.on("inputChange", data => {
    const { row, cell, value } = data;
    const targetCell = cells[row][cell];
    targetCell.value = value;
});

// Kada drugi igraƒç resetuje polja
socket.on("reset", () => {
    resetCells();
});

</script>
</body>
</html>
